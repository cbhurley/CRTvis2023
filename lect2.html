<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Catherine Hurley">

<title>Data visualisation in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lect2_files/libs/clipboard/clipboard.min.js"></script>
<script src="lect2_files/libs/quarto-html/quarto.js"></script>
<script src="lect2_files/libs/quarto-html/popper.min.js"></script>
<script src="lect2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lect2_files/libs/quarto-html/anchor.min.js"></script>
<link href="lect2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lect2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lect2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lect2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lect2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#part-ii-advanced-displays" id="toc-part-ii-advanced-displays" class="nav-link active" data-scroll-target="#part-ii-advanced-displays">Part II Advanced displays</a>
  <ul class="collapse">
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation">Preparation</a></li>
  <li><a href="#big-data" id="toc-big-data" class="nav-link" data-scroll-target="#big-data">Big data</a></li>
  <li><a href="#scatterplot-matrix" id="toc-scatterplot-matrix" class="nav-link" data-scroll-target="#scatterplot-matrix">Scatterplot matrix</a></li>
  <li><a href="#parallel-coordinates" id="toc-parallel-coordinates" class="nav-link" data-scroll-target="#parallel-coordinates">Parallel coordinates</a></li>
  <li><a href="#practice-3" id="toc-practice-3" class="nav-link" data-scroll-target="#practice-3">Practice 3</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing data</a></li>
  <li><a href="#correlation-plots" id="toc-correlation-plots" class="nav-link" data-scroll-target="#correlation-plots">Correlation plots</a></li>
  <li><a href="#titanic-case-study" id="toc-titanic-case-study" class="nav-link" data-scroll-target="#titanic-case-study">titanic case study</a></li>
  <li><a href="#practice-4" id="toc-practice-4" class="nav-link" data-scroll-target="#practice-4">Practice 4</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Data visualisation in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Catherine Hurley </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Maynooth University
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<section id="part-ii-advanced-displays" class="level1">
<h1>Part II Advanced displays</h1>
<section id="preparation" class="level2">
<h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<p>You will find the material for this lecture on github here <a href="https://github.com/cbhurley/CRT2023vis" class="uri">https://github.com/cbhurley/CRT2023vis</a> and a copy of this lecture <a href="http://htmlpreview.github.io/?https://github.com/cbhurley/CRT2023vis/blob/master/lect2.html">here</a></p>
<p>First install these packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"GGally"</span>, <span class="st">"ISLR2"</span>, <span class="st">"naniar"</span>, <span class="st">"hexbin"</span>, <span class="st">"ggpcp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and load with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk) <span class="co"># for the data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"bike.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="big-data" class="level2">
<h2 class="anchored" data-anchor-id="big-data">Big data</h2>
<p><code>ISLR2</code> has an hourly version of the bike data with 8645 observations.</p>
<p>The plot of registered versus casual users is</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>There is likely lot of overplotting. To check this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">nrow</span>(Bikeshare), <span class="fu">nrow</span>(<span class="fu">distinct</span>(<span class="fu">select</span>(Bikeshare, registered, casual))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8645 5463</code></pre>
</div>
</div>
<p>Jittering will randomly undo rounding, and using alpha will help too</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">size=</span>.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>So now the overplotting is most severe for registered &lt; 200 and casual &lt; 50.</p>
<p><code>geom_count</code> will size points in proportion to count, but this is not useful for large <span class="math inline">\(n\)</span> datasets.</p>
<p>Other options are to form 2d bins, count the number of observations in each, and color in proportion to the frequency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>registered, <span class="at">y=</span>casual))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span> <span class="fu">geom_bin2d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>I prefer to make my colour scale light to dark:</p>
<div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>() <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span> ,<span class="at">trans=</span><span class="st">"log10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>The second plot takes a log of the counts so you get a better spread of colours. This is needed because there is so much skewness in the count distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span> ,<span class="at">trans=</span><span class="st">"log10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p><code>stat_binhex</code> uses hexagonal binning</p>
<p>A more advanced plot fits a 2d kernel density estimate and draw this as a contour plot.</p>
<div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_density2d</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(level)), <span class="at">geom =</span> <span class="st">"polygon"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>We no longer need the logged colour scale, because the bivariate density smooths out the count distribution.</p>
<p>The second plot fills in the contours with color.</p>
<p>Every <code>geom_</code> function has an associated <code>stat_</code> function that does the necessary calculations.</p>
<p>Conversely, every <code>stat_</code> function has an associated <code>geom_</code> function to do the drawing. So instead of <code>geom_density2d</code> you could use <code>stat_density2d</code> and you would get the same plot.</p>
<p>However, if you want to draw the density with a different <code>geom</code> other than the default <code>contour</code>, you need to use <code>stat_density2d</code> and specify the new <code>geom</code>, here <code>polygon"</code>.</p>
<p>For this data, the density plot smears out the two “wings” of the plot, so either the <code>geom_bin</code> or <code>geom_hex</code> with the logged colour scale is better.</p>
</section>
<section id="scatterplot-matrix" class="level2">
<h2 class="anchored" data-anchor-id="scatterplot-matrix">Scatterplot matrix</h2>
<p>Back to the smaller dataset.</p>
<p>Go to articles tab for info <a href="https://ggobi.github.io/ggally/" class="uri">https://ggobi.github.io/ggally/</a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(bike, <span class="at">columns=</span><span class="fu">c</span>(<span class="st">"casual"</span>,<span class="st">"registered"</span>,<span class="st">"cnt"</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>You can change what is plotted on lower, upper and diagonal,using <code>lower=</code> etc. Putting in <code>mapping=</code> gives densities for both years separately</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  bike,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> yr),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"casual"</span>, <span class="st">"registered"</span>, <span class="st">"cnt"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smooth"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> F,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p><code>ggpairs</code> can handle factors as well. In this plot <code>yrs</code> is in as a plot variable, and as colour.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  bike,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> yr),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"casual"</span>, <span class="st">"registered"</span>, <span class="st">"cnt"</span>, <span class="st">"yr"</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smooth"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> F,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="parallel-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="parallel-coordinates">Parallel coordinates</h2>
<p>These can be constructed with function <code>ggparcoord</code> from GGally.</p>
<p>But, a newer package called <code>ggpcp</code> is better, as it handles factors as well.</p>
<p>Construction: with a sample of 20 bike observations</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>To see what certain patterns look like in a parallel coordinate plot, let us look at some fake data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">+</span> .<span class="dv">3</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="sc">-</span>y<span class="sc">+</span> .<span class="dv">1</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="sc">-</span>z<span class="sc">+</span> .<span class="dv">5</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(<span class="fu">data.frame</span>(x,y,z,w))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Positive correlation exhibits as parallel segments.</p>
<p>Negative correlation has crossing. The stronger the negative correlation the smaller the pinch point.</p>
<p>This is how you create the parallel coordinate plot in <code>ggpcp</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpcp)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>bike[s,] <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>yr)) <span class="sc">+</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Here, all variables are scaled to the unit interval individually. Variables that are positively correlated will have parallel line segments, here registered and cnt.</p>
<p>Other scaling options are available eg</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>bike[s,] <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"raw"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>yr)) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>In raw, no scaling is done. Here you can see that most users per day are registered.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>workingday), <span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the above we see that there is a difference in the casual-registered association for workingday or not. Both groups have positive association but slopes are different. There are more casual users at the weekend.</p>
<p>Verifying with a scatterplot</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>bike, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered, <span class="at">color=</span>workingday)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The same pattern was evident in the full bike data.</p>
<p>Standard parallel coordinate plots require numeric variables. There are variants that have been defined for categorical variables.</p>
<p>With <code>ggpcp</code> factor variables can be used as an axis variable:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(workingday, casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_arrange</span>() <span class="sc">|&gt;</span> <span class="co"># spaces out factor variables</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_pcp_boxes</span>(<span class="at">boxwidth =</span> <span class="fl">0.1</span>, <span class="at">fill=</span><span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>workingday), <span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_labels</span>() <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practice-3" class="level2">
<h2 class="anchored" data-anchor-id="practice-3">Practice 3</h2>
<p>Using the <code>penguins</code> dataset, make a plot of the four dimension variables, colored by species.</p>
<div class="cell">
<details>
<summary>Solution</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(<span class="fu">na.omit</span>(penguins), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> species),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">columns=</span><span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(<span class="st">"smooth"</span>, <span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span>F, <span class="at">alpha=</span>.<span class="dv">5</span>)),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha=</span><span class="fl">0.5</span> )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Which pair of variables and species has the highest correlation?</p>
<p>Can you find two variables with negative correlation, but positive correlation within each species? This is called Simpson’s paradox.</p>
<p>Then make a parallel coordinate plot of the same four variables, with the same colouring scheme.</p>
<p>Can you identify presence of positive and negative correlation?</p>
<p>In this plot, how does the Gentoo species compare to the other two species?</p>
<p>Finally, make a parallel coordinate plot of species, island, and body_mass_g, coloured by species. How many species are on each island?</p>
</section>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">Missing data</h2>
<p>Here we use package naniar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_case</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="480"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>There are also facet options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_case</span>(penguins, <span class="at">facet=</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="480"></p>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(penguins, <span class="at">facet=</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Adelie and Gentoo have a few cases with missing values, Chinstrap cases are all complete.</p>
<p>The variables plot tells us that sex has the most missing values. There are just a few missings in the measurement variables.</p>
<p>The visualisation <code>vis_miss</code> is a heatmap identifying which values are missing in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>For the penguins, this tells us that there is one penguin each of the two Species that is missing on the numeric variables.</p>
<p>These numeric values are not missing at random. It could simply be there are two penguins that they were not able to measure.</p>
<p>An alternative visualisation for exploring combinations of variables that are missing is the upset plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_upset</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>This one tells us directly the numbers of missings on each of the variables.</li>
<li>There are 9 cases with missing sex only</li>
<li>There are two cases missing on the five listed variables.</li>
</ul>
<p>Check out the visualisations in <code>naniar</code> for more options, eg the vignette at <a href="https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html" class="uri">https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html</a></p>
</section>
<section id="correlation-plots" class="level2">
<h2 class="anchored" data-anchor-id="correlation-plots">Correlation plots</h2>
<p>These show a graphical representation of a correlation matrix.</p>
<div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bcor <span class="ot">&lt;-</span> <span class="fu">cor</span>(bike[,<span class="fu">sapply</span>(bike,is.numeric)], <span class="at">use=</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(bcor)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(bcor, <span class="at">diag=</span>F, <span class="at">order=</span><span class="st">"hclust"</span>, <span class="at">hclust.method=</span><span class="st">"average"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="lect2_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>The second variant</p>
<ul>
<li><p>removes the uninformative diagonal entries</p></li>
<li><p>orders the variables using clustering, which places high correlation pairs nearby</p></li>
<li><p>A new (as yet not on CRAN package from CRT student Amit Chinwan) produces association measures and plots for numerical, factors, and ordinal factors (and a lot more besides).</p></li>
</ul>
<p>Here we use <code>corVis::calc_assoc</code>, which calculates canonical correlation (non-negative) for pairs of factors, or factor-numerical pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corVis)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>bcor <span class="ot">&lt;-</span> <span class="fu">calc_assoc</span>(bike[,<span class="sc">-</span><span class="dv">1</span>]) <span class="co"># does not handle dates</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_assoc_matrix</span>(bcor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lect2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The time variables are associated with each other (yday, month, season), and these are also associated with the weather variables.</p>
</section>
<section id="titanic-case-study" class="level2">
<h2 class="anchored" data-anchor-id="titanic-case-study">titanic case study</h2>
<p>There were 2201 people aboard the titanic when it sank in 1912. A summary of the people on board and whether they survived or not is given in the titanicanic dataset.</p>
<p>Here are some images as it left its last port of call, Cobh.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="figs/titanic.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="figs/cobh.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Can we figure out from this data which category of passenger had the highest chance of survival?</p>
<p>This case study looks at 4 categorical variables simultaneously: - Survival (yes or no), - class (first, second, third, crew,) - gender (male or female) and - age (child or adult).</p>
<p>First we look at the number of survivors by class</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#titanicanic  # a 4d array....</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Titanic)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Class Sex    Age   Survived  Freq
  &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;
1 1st   Male   Child No           0
2 2nd   Male   Child No           0
3 3rd   Male   Child No          35
4 Crew  Male   Child No           0
5 1st   Female Child No           0
6 2nd   Female Child No           0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>titanic<span class="ot">&lt;-</span> titanic[<span class="fu">c</span>(<span class="dv">17</span><span class="sc">:</span><span class="dv">32</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>),]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>and then the survival rates by class</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>There is a big difference in Survival rates across the classes.</li>
<li>First class passengers have the highest chance of survival, crew members the lowest.</li>
</ul>
<p>We can bring in gender with <code>facet_wrap</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Sex) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Third class females do worse than crew females (46% versus 87%), and third class males do worse than crew males (17% versus 22%), although when gender is ignored the situation is reversed.</p></li>
<li><p>This apparent paradox (Simpson’s paradox) occurs because the vast majority of crew members are male.</p></li>
<li><p>The overall 3rd class survival rate of 25% is an average of 46% and 17%, but as there are 2.6 times more men than women in 3rd class 17% gets more weight.</p></li>
<li><p>The overall crew survival rate of 24% is an average of 87% and 22%, but as there are 37 times more men than women in crew class 87% gets very little weight.</p></li>
</ul>
<p>Finally, bringing in age</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Age<span class="sc">+</span> Sex) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="528"></p>
</figure>
</div>
</div>
</div>
<p>We can get some simplification by showing the survival rate, that is omit the red sections.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>titanicR <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>titanic <span class="sc">|&gt;</span>  <span class="fu">group_by</span>(Class, Sex,Age) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">died=</span>Freq[<span class="dv">2</span>], <span class="at">survived=</span>Freq[<span class="dv">1</span>], <span class="at">rate=</span>survived<span class="sc">/</span><span class="fu">sum</span>(Freq))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>titanicR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 6
   Class Sex    Age    died survived     rate
   &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 1st   Male   Child     0        5   1     
 2 1st   Male   Adult   118       57   0.326 
 3 1st   Female Child     0        1   1     
 4 1st   Female Adult     4      140   0.972 
 5 2nd   Male   Child     0       11   1     
 6 2nd   Male   Adult   154       14   0.0833
 7 2nd   Female Child     0       13   1     
 8 2nd   Female Adult    13       80   0.860 
 9 3rd   Male   Child    35       13   0.271 
10 3rd   Male   Adult   387       75   0.162 
11 3rd   Female Child    17       14   0.452 
12 3rd   Female Adult    89       76   0.461 
13 Crew  Male   Child     0        0 NaN     
14 Crew  Male   Adult   670      192   0.223 
15 Crew  Female Child     0        0 NaN     
16 Crew  Female Adult     3       20   0.870 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanicR, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> rate)) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Age<span class="sc">+</span> Sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lect2_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>One of the examples in the <code>ggpcp</code> vignette has a parallel coordinates version of this data: <a href="https://heike.github.io/ggpcp/" class="uri">https://heike.github.io/ggpcp/</a></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/pcp.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="practice-4" class="level2">
<h2 class="anchored" data-anchor-id="practice-4">Practice 4</h2>
<p>Explore the survival rates for the data <code>lusitania.csv</code> on <a href="https://github.com/cbhurley/CRT2023vis" class="uri">https://github.com/cbhurley/CRT2023vis</a> This is a tabulated version of the data, in the same format as <code>titanic</code>. The complete dataset is available on Kaggle.</p>
<p>You can find out more about the shipwreck <a href="https://en.wikipedia.org/wiki/RMS_Lusitania" class="uri">https://en.wikipedia.org/wiki/RMS_Lusitania</a></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>ggplot2: Elegant Graphics for Data Analysis <a href="https://ggplot2-book.org" class="uri">https://ggplot2-book.org</a> Hadley Wickham</p>
<p>Data visualization a practical introduction by Kieran Healy <a href="https://socviz.co" class="uri">https://socviz.co</a></p>
<!-- https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/ -->
<p>Fundamentals of Data Visualization by Claus Wilke <a href="https://clauswilke.com/dataviz/" class="uri">https://clauswilke.com/dataviz/</a> (no R)</p>
<p>Best Practices for Data Visualisation from Royal Statistical Society <a href="https://royal-statistical-society.github.io/datavisguide/docs/principles.html" class="uri">https://royal-statistical-society.github.io/datavisguide/docs/principles.html</a></p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Data visualisation in R"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Catherine Hurley"</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Maynooth University</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">    email: catherine.hurley@mu.ie</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: tibble</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">warning=</span>F)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Part II Advanced displays</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preparation</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>You will find the material for this lecture on github here <span class="ot">&lt;https://github.com/cbhurley/CRT2023vis&gt;</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>and a copy of this lecture</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">here</span><span class="co">](http://htmlpreview.github.io/?https://github.com/cbhurley/CRT2023vis/blob/master/lect2.html)</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>First install these packages</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"GGally"</span>, <span class="st">"ISLR2"</span>, <span class="st">"naniar"</span>, <span class="st">"hexbin"</span>, <span class="st">"ggpcp"</span>))</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>and load with</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk) <span class="co"># for the data</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"bike.Rdata"</span>)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Big data</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a><span class="in">`ISLR2`</span> has an hourly version of the bike data with 8645  observations.</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>The plot of registered versus casual users is</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4.5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>There is likely lot of overplotting.  To check this</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">nrow</span>(Bikeshare), <span class="fu">nrow</span>(<span class="fu">distinct</span>(<span class="fu">select</span>(Bikeshare, registered, casual))))</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>Jittering will randomly undo rounding, and using alpha will help too</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4.5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered)) <span class="sc">+</span> </span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">size=</span>.<span class="dv">5</span>)</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>So now the overplotting is most severe for registered &lt; 200 and casual &lt; 50.</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_count`</span> will size points in proportion to count, but this is not useful for large $n$ datasets.</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>Other options are to form 2d bins, count the number of observations in each, and color in</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>proportion to the frequency.</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=5, fig.height=4}</span></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>Bikeshare, <span class="fu">aes</span>(<span class="at">x=</span>registered, <span class="at">y=</span>casual))</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span> <span class="fu">geom_bin2d</span>()</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>I prefer to make my colour scale light to dark:</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>() <span class="sc">+</span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span>)</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>() <span class="sc">+</span></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span> ,<span class="at">trans=</span><span class="st">"log10"</span>)</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>The second plot takes a log of the counts so you get a better spread of colours. This is needed because there is so</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>much skewness in the count distribution.</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4, fig.height=3}</span></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span>  </span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span> ,<span class="at">trans=</span><span class="st">"log10"</span>)</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a><span class="in">`stat_binhex`</span> uses hexagonal binning</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a> A more advanced plot fits a 2d kernel density estimate and draw this as a contour plot.</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_density2d</span>()</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(level)), <span class="at">geom =</span> <span class="st">"polygon"</span>) <span class="sc">+</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"wheat"</span>, <span class="at">high =</span> <span class="st">"blue"</span>)</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>  </span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F, eval=F}</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_density2d_filled</span>() </span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>We no longer need the logged colour scale, because the bivariate density smooths out the count distribution.</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>The second plot fills in the contours with color.</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>Every <span class="in">`geom_`</span> function has an associated <span class="in">`stat_`</span> function that does the necessary calculations.</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>Conversely, every <span class="in">`stat_`</span> function has an associated <span class="in">`geom_`</span> function to do the drawing. So instead of</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_density2d`</span> you could use  <span class="in">`stat_density2d`</span> and you would get the same plot.</span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>However, if you want to draw the density with a different <span class="in">`geom`</span> other than the default <span class="in">`contour`</span>, you need</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>to use <span class="in">`stat_density2d`</span> and specify the new <span class="in">`geom`</span>, here <span class="in">`polygon"`</span>.</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>For this data, the density plot smears out the two "wings" of the plot, so either the <span class="in">`geom_bin`</span> or <span class="in">`geom_hex`</span> with</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>the logged colour scale is better.</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scatterplot matrix</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>Back to the smaller dataset.</span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>Go to articles tab for info</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a><span class="ot">&lt;https://ggobi.github.io/ggally/&gt;</span></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=4.5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(bike, <span class="at">columns=</span><span class="fu">c</span>(<span class="st">"casual"</span>,<span class="st">"registered"</span>,<span class="st">"cnt"</span> ))</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>You can change what is plotted on lower, upper and diagonal,using</span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a><span class="in">`lower=`</span> etc.</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>Putting in <span class="in">`mapping=`</span> gives densities for both years separately</span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=4.5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>  bike,</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> yr),</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"casual"</span>, <span class="st">"registered"</span>, <span class="st">"cnt"</span>),</span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(</span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smooth"</span>,</span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> F,</span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a><span class="in">`ggpairs`</span> can handle factors as well.</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>In this plot <span class="in">`yrs`</span> is in as a plot variable, and as colour.</span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=4.5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(</span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>  bike,</span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> yr),</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"casual"</span>, <span class="st">"registered"</span>, <span class="st">"cnt"</span>, <span class="st">"yr"</span>),</span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(</span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smooth"</span>,</span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> F,</span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parallel coordinates</span></span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>These can be constructed with function <span class="in">`ggparcoord`</span> from GGally.</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a>But, a newer package called <span class="in">`ggpcp`</span> is better, as it handles factors as well.</span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>Construction: with a sample of 20 bike observations</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=3, fig.align="center", eval=T, echo=F}</span></span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(bike),<span class="dv">20</span>)</span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(bike[s,], <span class="at">columns=</span><span class="fu">match</span>(<span class="fu">c</span>(<span class="st">"casual"</span>,<span class="st">"registered"</span>,<span class="st">"cnt"</span>),<span class="fu">names</span>(bike)),</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>           <span class="at">groupColumn =</span> <span class="st">"yr"</span>,</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>           <span class="at">showPoints=</span><span class="cn">TRUE</span>,</span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>           <span class="at">alphaLines=</span><span class="dv">0</span>,<span class="at">scale=</span><span class="st">"uniminmax"</span>)</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(bike[s,], <span class="at">columns=</span><span class="fu">match</span>(<span class="fu">c</span>(<span class="st">"casual"</span>,<span class="st">"registered"</span>,<span class="st">"cnt"</span>),<span class="fu">names</span>(bike)),</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>           <span class="at">groupColumn =</span> <span class="st">"yr"</span>,</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>           <span class="at">showPoints=</span><span class="cn">TRUE</span>,</span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a>           <span class="at">alphaLines=</span><span class="dv">1</span>,<span class="at">scale=</span><span class="st">"uniminmax"</span>)</span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(bike[s,], <span class="at">columns=</span><span class="fu">match</span>(<span class="fu">c</span>(<span class="st">"casual"</span>,<span class="st">"registered"</span>,<span class="st">"cnt"</span>),<span class="fu">names</span>(bike)),</span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a>           <span class="at">groupColumn =</span> <span class="st">"yr"</span>,<span class="at">scale=</span><span class="st">"uniminmax"</span>)</span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>To see what certain patterns look like in a parallel coordinate plot, let</span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>us look at some fake data</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">+</span> .<span class="dv">3</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="sc">-</span>y<span class="sc">+</span> .<span class="dv">1</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="sc">-</span>z<span class="sc">+</span> .<span class="dv">5</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=3, fig.align="center", echo=TRUE}</span></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a><span class="fu">ggparcoord</span>(<span class="fu">data.frame</span>(x,y,z,w))</span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>Positive correlation exhibits as parallel segments.</span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a>Negative correlation has crossing. The stronger the negative correlation the smaller the pinch point.</span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a>This is how you create the parallel coordinate plot in <span class="in">`ggpcp`</span></span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpcp)</span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>bike[s,] <span class="sc">|&gt;</span></span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>yr)) <span class="sc">+</span> </span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>Here, all variables are scaled to the unit interval individually.</span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>Variables that are positively correlated will have parallel line segments, here registered and cnt.</span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a>Other scaling options are available eg</span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>bike[s,] <span class="sc">|&gt;</span></span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"raw"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>yr)) <span class="sc">+</span> </span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>In raw, no scaling is done. Here you can see that most users per day are registered.</span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,fig.width=7, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>workingday), <span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>In the above we see that there is a difference in the casual-registered association for workingday or not.</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>Both groups have positive association but slopes are different.</span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>There are more casual users at the weekend.</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a>Verifying with a scatterplot</span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=5, fig.height=4, fig.align="center"}</span></span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>bike, <span class="fu">aes</span>(<span class="at">x=</span>casual, <span class="at">y=</span>registered, <span class="at">color=</span>workingday)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a>The same pattern was evident in the full bike data.</span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a>Standard parallel coordinate plots require numeric variables. There are variants that have been defined for</span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a>categorical variables.</span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a>With <span class="in">`ggpcp`</span> factor variables can be used as an axis variable:</span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,fig.width=7, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_select</span>(workingday, casual<span class="sc">:</span>cnt) <span class="sc">|&gt;</span></span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_scale</span>(<span class="at">method=</span><span class="st">"uniminmax"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pcp_arrange</span>() <span class="sc">|&gt;</span> <span class="co"># spaces out factor variables</span></span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes_pcp</span>()) <span class="sc">+</span> </span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_pcp_boxes</span>(<span class="at">boxwidth =</span> <span class="fl">0.1</span>, <span class="at">fill=</span><span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_axes</span>() <span class="sc">+</span> </span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp</span>(<span class="fu">aes</span>(<span class="at">color=</span>workingday), <span class="at">alpha=</span>.<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pcp_labels</span>() <span class="sc">+</span></span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice 3</span></span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`penguins`</span> dataset, make a plot of  the four dimension variables, colored by species.</span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,practice3, fig.width=6, fig.height=5, fig.align="center", echo=F, eval=F}</span></span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(<span class="fu">na.omit</span>(penguins), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> species),</span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a>            <span class="at">columns=</span><span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span>  <span class="fu">wrap</span>(<span class="st">"smooth"</span>, <span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span>F, <span class="at">alpha=</span>.<span class="dv">5</span>)),</span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha=</span><span class="fl">0.5</span> )))</span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, practice3,eval=F}</span></span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Solution"</span></span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a>Which pair of variables and species has the highest correlation?</span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a>Can you find two variables with negative correlation, but positive correlation within each species?</span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a>This is called Simpson's paradox.</span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a>Then make a parallel coordinate plot of the same four variables, with the same colouring scheme.</span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a>Can you identify presence of positive and negative correlation?</span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a>In this plot, how does the Gentoo species compare to the other two species?</span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a>Finally, make a parallel coordinate plot of species, island, and body_mass_g, coloured by species.</span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a>How many species are on each island?</span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,fig.width=6, fig.height=3, fig.align="center", echo=F, eval=F}</span></span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">vars=</span><span class="fu">vars</span>(bill_length_mm<span class="sc">:</span>body_mass_g), <span class="at">color=</span>species))<span class="sc">+</span></span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_pcp</span>(<span class="at">alpha=</span>.<span class="dv">4</span>)</span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">vars=</span><span class="fu">vars</span>(species, island, <span class="fu">starts_with</span>(<span class="st">"body"</span>)), <span class="at">color=</span>species))<span class="sc">+</span></span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pcp_box</span>(<span class="at">boxwidth =</span> <span class="fl">0.1</span>, <span class="at">fill=</span><span class="st">"grey70"</span>)<span class="sc">+</span></span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pcp</span>(<span class="at">alpha=</span>.<span class="dv">4</span>,<span class="at">boxwidth =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pcp_text</span>(<span class="at">boxwidth =</span> <span class="fl">0.1</span>)</span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a><span class="fu">## Missing data</span></span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a>Here we use package naniar.</span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=3.5}</span></span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_case</span>(penguins)</span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(penguins)</span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a>There are also facet options.</span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=3.5}</span></span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_case</span>(penguins, <span class="at">facet=</span>species)</span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(penguins, <span class="at">facet=</span>species)</span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a>Adelie and Gentoo have a few cases with missing values, Chinstrap cases</span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a>are all complete.</span>
<span id="cb39-402"><a href="#cb39-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-403"><a href="#cb39-403" aria-hidden="true" tabindex="-1"></a>The variables plot tells us that sex has the most missing values. There are just a few missings in the  measurement variables.</span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a>The visualisation <span class="in">`vis_miss`</span> is a heatmap identifying which values are missing in the dataset.</span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=6}</span></span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(penguins)</span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a>For the penguins, this tells us that there is one penguin each of the two Species that is missing on the numeric variables.</span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a>These numeric values are not missing at random. It could simply be there are</span>
<span id="cb39-419"><a href="#cb39-419" aria-hidden="true" tabindex="-1"></a>two penguins that they were not able to measure.</span>
<span id="cb39-420"><a href="#cb39-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-421"><a href="#cb39-421" aria-hidden="true" tabindex="-1"></a>An alternative visualisation for exploring combinations of variables that are missing is the upset plot</span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_upset</span>(penguins)</span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This one tells us directly the numbers of missings on each of the variables.</span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are 9 cases with missing sex only</span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are two cases missing on the five listed variables.</span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-433"><a href="#cb39-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-434"><a href="#cb39-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-435"><a href="#cb39-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a>Check out the visualisations in <span class="in">`naniar`</span> for more options, eg the vignette at <span class="ot">&lt;https://cran.r-project.org/web/packages/naniar/vignettes/naniar-visualisation.html&gt;</span></span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a><span class="fu">## Correlation plots</span></span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a>These show a graphical representation of a correlation matrix.</span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a>bcor <span class="ot">&lt;-</span> <span class="fu">cor</span>(bike[,<span class="fu">sapply</span>(bike,is.numeric)], <span class="at">use=</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(bcor)</span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(bcor, <span class="at">diag=</span>F, <span class="at">order=</span><span class="st">"hclust"</span>, <span class="at">hclust.method=</span><span class="st">"average"</span>)</span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a>The second variant </span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>removes the uninformative diagonal entries</span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>orders the variables using clustering, which places high correlation pairs nearby</span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A new (as yet not on CRAN package from CRT student Amit Chinwan) produces association measures and plots for numerical, factors, and ordinal factors (and a lot more besides).</span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a>Here we use <span class="in">`corVis::calc_assoc`</span>, which calculates canonical correlation (non-negative) for pairs of factors, or factor-numerical pairs.</span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=7, fig.height=7}</span></span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corVis)</span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a>bcor <span class="ot">&lt;-</span> <span class="fu">calc_assoc</span>(bike[,<span class="sc">-</span><span class="dv">1</span>]) <span class="co"># does not handle dates</span></span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_assoc_matrix</span>(bcor)</span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a>The time variables are associated with each other (yday, month, season), and these are also associated with the weather variables.</span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a><span class="fu">## titanic case study</span></span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a>There were 2201 people aboard the titanic when it sank in 1912.</span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a>A summary of the people on board and whether they survived or not is given in the titanicanic dataset.</span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a>Here are some images as it left its last port of call, Cobh.</span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol=2}</span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a><span class="al">![](figs/titanic.png)</span></span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a><span class="al">![](figs/cobh.png)</span></span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a>Can we figure out from this data which category of passenger had the highest chance of survival?</span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a>This case study looks at 4 categorical variables simultaneously:</span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Survival (yes or no), </span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>class (first, second, third, crew,)</span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>gender (male or female) and </span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>age (child or adult).</span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a>First we look at the number of survivors by class</span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4.5, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a><span class="co">#titanicanic  # a 4d array....</span></span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Titanic)</span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic)</span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a>titanic<span class="ot">&lt;-</span> titanic[<span class="fu">c</span>(<span class="dv">17</span><span class="sc">:</span><span class="dv">32</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>),]</span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() </span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a>and then the survival rates by class</span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4.5, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) </span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is a big difference in Survival rates across the classes.</span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First class passengers have the highest chance of survival, crew members the lowest. </span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a>We can bring in gender with <span class="in">`facet_wrap`</span></span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-520"><a href="#cb39-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=5.5, fig.height=3, fig.align="center"}</span></span>
<span id="cb39-521"><a href="#cb39-521" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Sex) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Rate"</span>)</span>
<span id="cb39-524"><a href="#cb39-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-525"><a href="#cb39-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Third class females do worse than crew females (46% versus 87%), and</span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a>third class males do worse than crew males (17% versus 22%), although when gender is ignored the situation is</span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a>reversed.</span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This apparent paradox (Simpson's paradox) occurs because the vast majority of crew members are male.</span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The overall 3rd class survival rate of 25% is an average of 46% and 17%, but as there are 2.6 times</span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a>more men than women in 3rd class 17% gets more weight.</span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The overall crew survival rate of 24% is an average of 87% and 22\%, but as there are 37 times</span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a>more men than women in crew class 87% gets very little weight.</span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a>Finally, bringing in age</span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=5.5, fig.height=4.5, fig.align="center"}</span></span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanic, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> Freq,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Age<span class="sc">+</span> Sex) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Rate"</span>)</span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a>We can get some simplification by showing the survival rate, that is omit the red sections.</span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-548"><a href="#cb39-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  fig.width=4.5, fig.height=4.5, fig.align="center"}</span></span>
<span id="cb39-549"><a href="#cb39-549" aria-hidden="true" tabindex="-1"></a>titanicR <span class="ot">&lt;-</span> </span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a>titanic <span class="sc">|&gt;</span>  <span class="fu">group_by</span>(Class, Sex,Age) <span class="sc">|&gt;</span></span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">died=</span>Freq[<span class="dv">2</span>], <span class="at">survived=</span>Freq[<span class="dv">1</span>], <span class="at">rate=</span>survived<span class="sc">/</span><span class="fu">sum</span>(Freq))</span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a>titanicR</span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> titanicR, <span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> rate)) <span class="sc">+</span></span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Age<span class="sc">+</span> Sex) </span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-561"><a href="#cb39-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-562"><a href="#cb39-562" aria-hidden="true" tabindex="-1"></a>One of the examples in the <span class="in">`ggpcp`</span> vignette has a parallel coordinates version of this data:</span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a><span class="ot">&lt;https://heike.github.io/ggpcp/&gt;</span>  </span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F, eval=T,  out.width="80%",fig.align='center', fig.show='hold'}</span></span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">c</span>(<span class="st">"figs/pcp.png"</span>))</span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice 4</span></span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a>Explore the survival rates for the data <span class="in">`lusitania.csv`</span> on <span class="ot">&lt;https://github.com/cbhurley/CRT2023vis&gt;</span></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a>This is a tabulated version of the data, in the same format as <span class="in">`titanic`</span>. The complete dataset</span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a>is available on Kaggle.</span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a>You can find out more about the shipwreck <span class="ot">&lt;https://en.wikipedia.org/wiki/RMS_Lusitania&gt;</span></span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-579"><a href="#cb39-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-580"><a href="#cb39-580" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a>ggplot2: Elegant Graphics for Data Analysis <span class="ot">&lt;https://ggplot2-book.org&gt;</span> Hadley Wickham</span>
<span id="cb39-583"><a href="#cb39-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-584"><a href="#cb39-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a>Data visualization a practical introduction by Kieran Healy <span class="ot">&lt;https://socviz.co&gt;</span></span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/ --&gt;</span></span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a>Fundamentals of Data Visualization by Claus Wilke <span class="ot">&lt;https://clauswilke.com/dataviz/&gt;</span> (no R) </span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a>Best Practices for Data Visualisation from Royal Statistical Society <span class="ot">&lt;https://royal-statistical-society.github.io/datavisguide/docs/principles.html&gt;</span></span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, eval=FALSE, purl=FALSE}</span></span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">purl</span>(<span class="st">"lect2.Rmd"</span>)</span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>